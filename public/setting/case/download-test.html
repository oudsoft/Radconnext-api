<!DOCTYPE html>
<html>
  <head>
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <title>Test Download Zip</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="../../lib/jquery.js"></script>
    <script type="text/javascript" src="../../lib/jquery-ui.min.js"></script>
  </head>
  <body>
    <div>
      <div>Zip File</div>
      <div>
        <a href="/img/usr/zip/SAITHONG_RUCHISAN-20221128-122758-141002.zip" target="_blank">SAITHONG RUCHISAN</a>
      </div>
      <div>
        <a href="/img/usr/zip/CHIRAWUT_SUNTHONWARI-20221123-082650-104202.zip" target="_blank">CHIRAWUT SUNTHONWARI</a>
      </div>
    </div>
    <div style="height: 50px;"></div>
    <div>
      <div>Image File</div>
      <div>
        <a id="imgtest1" href="/img/usr/upload/13439ed1-116b.jpg" target="_blank">13439ed1-116b.jpg</a>
      </div>
      <div>
        <a id="imgtest2" href="/img/usr/upload/18231376-4b32.jpg" target="_blank">18231376-4b32.jpg</a>
      </div>
    </div>
  </body>
</html>

<script type="text/javascript">
  function getBinaryContent(url, name) {
    //return new Promise((resolve, reject) => {
      try {
        let xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        //xhr.addEventListener("load", transferComplete);
        //xhr.addEventListener("error", transferFailed);
        xhr.send();
        xhr.onreadystatechange = function(){
          console.log(xhr.readyState);
          if (xhr.readyState == 4) {
            //let response = JSON.parse(xhr.responseText);
            /*
            console.log(xhr.responseText);
            let pom = document.createElement('a');
            pom.setAttribute('target', "_blank");
            pom.setAttribute('href', xhr.responseText);
            pom.setAttribute('download', name);
            pom.click();
            */
            const reader = new FileReader();
            reader.onload = (evt) => {
              console.log(evt.target.result);
            };
            //reader.readAsText(xhr.responseText);
            reader.readAsDataURL(xhr.response)
          }
        }
        xhr.onload = function(data){
          console.log(data);
        }
      } catch (err) {
        reject(new Error(err));
      }
    //});
  }
  function transferComplete(evt) {
    console.log(evt);
  }
  function transferFailed(evt) {
    console.log(evt);
  }

  let url = '/img/usr/zip/SAITHONG_RUCHISAN-20221128-122758-141002.zip';
  //getBinaryContent(url, 'zip1.zip');

  $('#imgtest1').on('click', (evt)=>{
    evt.preventDefault();
    url = '/img/usr/upload/13439ed1-116b.jpg';
    getBinaryContent(url, 'img1.jpg');
  })
</script>
